---
# -----------------------------
# This Ansible playbook setup the environment:
#
# Installation of K3S and Liqo on the local node and remote node (myhosts)
#
# Installation and setup of the ddns updater on a specific node (ddns)
#
# -----------------------------

- name: Cluster prep
  hosts: myhosts
  gather_facts: true
  become: true
  pre_tasks:
    - name : Get k3s version
      ansible.builtin.command: k3s --version
      register: k3s_version_output
      changed_when: false
      ignore_errors: true

  roles:
    - role: prereq
      when: k3s_version_output.rc != 0
    - role: k3s
      when: k3s_version_output.rc != 0
    - role: liqo

- name: DDNS updater setup
  hosts: ddns
  become: true

  roles:
    - role: ddns